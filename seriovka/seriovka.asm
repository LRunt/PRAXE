.NOLIST
.INCLUDE"m128def.inc"
.LIST
.CSEG

.MACRO podprogram1
CPI R20,@0
BRNE @1
JMP @2
.ENDMACRO

.MACRO podprogram2
LDI R21,8 				;pocet pozic ktere se nactou z DB
@0:
LDI ZL,LOW(KOMBINACE*2)
LDI ZH,HIGH(KOMBINACE*2)
LPM R22,Z+				;nacitani hodnot z DB
LDI R23,@1				;kombinace která bude svítit na displeji
OUT PORTD,R22			;posílám pozici
OUT PORTB,R23			;posílam kombinaci cisla
CALL DELAY
DEC R21
BRNE @0
JMP MAIN
.ENDMACRO

LDI R24,LOW(RAMEND)
OUT SPL,R24
LDI R24,HIGH(RAMEND)
OUT SPH,R24
LDI R24,0xFF
OUT DDRB,R24
OUT DDRD,R24
OUT PORTB,R24
OUT PORTD,R24

MAIN:
LDI R20, (1<<TXEN0)|(1<<RXEN0) ;zapnutí serial rx
OUT UCSR0B, R20
LDI R20, UDR0 ;nacitani hodnot z UART
NULA:
podprogram1 0b00000000,JEDNA,NULAA
JEDNA:
podprogram1 0b00000001,DVA,JEDNICKA
DVA:
podprogram1 0b00000010,TRI,DVOJKA
TRI:
podprogram1 0b00000011,CTYRI,TROJKA
CTYRI:
podprogram1 0b00000100,PET,CTYRKA
PET:
podprogram1 0b00000101,SEST,PETKA
SEST:
podprogram1 0b00000110,SEDM,SESTKA
SEDM:
podprogram1 0b00000111,OSM,SEDMICKA
OSM:
podprogram1 0b00001000,DEVET,OSMICKA
DEVET:
podprogram1 0b00001001,ZPET,DEVITKA
ZPET:
JMP MAIN

NULAA:
podprogram2 N1,0b11111100 
JEDNICKA:
podprogram2 J1,0b01100000
DVOJKA:
podprogram2 D1,0b11011010 
TROJKA:
podprogram2 T1,0b11110010 
CTYRKA:
podprogram2 C1,0b01100110 
PETKA:
podprogram2 P1,0b10110110 
SESTKA:
podprogram2 S1,0b00111110 
SEDMICKA:
podprogram2 S2,0b11100000 
OSMICKA:
podprogram2 O1,0b11111110 
DEVITKA:
podprogram2 D2,0b11100110  


DELAY: ;delay 1ms
    LDI  R18, 21
    LDI  R19, 198
L2: DEC  R19
    BRNE L2
    DEC  R18
    BRNE L2
    NOP
    RJMP MAIN ;skok na zacatek

KOMBINACE: .DB 0B11110011,0b11110010,0b11110001,0b11110000,0b11110100,0b11110100,0b11110101,0b11110110,0b11110111
